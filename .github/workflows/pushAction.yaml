on: push


jobs:
  buildAndSend:
    name: Build And Send Message
    runs-on: ubuntu-18.04

    steps:
      # Log The Contexts
      # - run: "echo 'Github: ${{ toJSON(github) }}'"
      # - run: "echo 'Env: ${{ toJSON(env) }}'"
      # - run: "echo 'Job: ${{ toJSON(job) }}'"
      # - run: "echo 'Steps: ${{ toJSON(steps) }}'"
      # - run: "echo 'Runner: ${{ toJSON(runner) }}'"
      # - run: "echo 'Secrets: ${{ toJSON(secrets) }}'"
      # - run: "echo 'Strategy: ${{ toJSON(strategy) }}'"
      # - run: "echo 'Matrix: ${{ toJSON(matrix) }}'"
      # - run: "echo 'Needs: ${{ toJSON(needs) }}'"

      - name: "checkout"
        uses: actions/checkout@v2

      - name: "Setup Node"
        uses: actions/setup-node@v1
        with:
          node-version: '14'

      - name: "Install Dependencies"
        run: "npm ci"

      - name: "build"
        run: "npm run build"
      

      - name: "sendmmm"
        env:
          MSG: '{
            "title": "${{ github.event.pusher.name }} Pushed",
            "description": "In repository: ${{ github.event.repository.html_url }}",
            "fields": [
              {"name": "Status", "value": "${{ job.status }}"}
            ]
          }'
        run: 'curl -H "Content-Type: application/json" -d "{\"embeds\": [$MSG]}" -X POST https://discord.com/api/webhooks/779046008684412979/UaQqJmOHg7nwqNAupSc04_hiE-Hmrk61VwTwtgMEnuLcXFe95S29omkXHE-ikOzNk5bZ'
    
      # - name: "Convert Github Object"
      #   id: cvtGithub
      #   uses: frabert/replace-string-action@v1.2
      #   with:
      #     string: '${{ toJSON(github) }}'
      #     replace-with: " "
      #     pattern: '"|\n'
      #     flags: g
      
      # - name: "embedFieldsTest"
      #   env:
      #     MSG: '{
      #       "title": "Fields Test",
      #       "description": "desc",
      #       "fields": [
      #         {"name": "Name", "value": "${{ steps.cvtGithub.outputs.replaced }}"}
      #       ]
      #     }'
      #   run: 'echo ${{ steps.cvtGithub.outputs.replaced }} ; curl -H "Content-Type: application/json" -d "{\"embeds\": [$MSG]}" -X POST https://discord.com/api/webhooks/779046008684412979/UaQqJmOHg7nwqNAupSc04_hiE-Hmrk61VwTwtgMEnuLcXFe95S29omkXHE-ikOzNk5bZ'
      
      # - name: "sendContexts"
      #   env:
      #     MSG: '{
      #       "title": "Contexts",
      #       "description": "desc"
      #       "fields": [
      #         {  "name": "Github",   "value":  "${{ toJSON(github) }}"    },
      #         {  "name": "Env",      "value":  "${{ toJSON(env) }}"       },
      #         {  "name": "Job",      "value":  "${{ toJSON(job) }}"       },
      #         {  "name": "Steps",    "value":  "${{ toJSON(steps) }}"     },
      #         {  "name": "Runner",   "value":  "${{ toJSON(runner) }}"    },
      #         {  "name": "Secrets",  "value":  "${{ toJSON(secrets) }}"   },
      #         {  "name": "Strategy", "value":  "${{ toJSON(strategy) }}"  },
      #         {  "name": "Matrix",   "value":  "${{ toJSON(matrix) }}"    },
      #         {  "name": "Needs",    "value":  "${{ toJSON(needs) }}"     }
      #       ]
      #     }'
      #   run: 'curl -H "Content-Type: application/json" -d "{\"embeds\": [$MSG]}" -X POST https://discord.com/api/webhooks/779046008684412979/UaQqJmOHg7nwqNAupSc04_hiE-Hmrk61VwTwtgMEnuLcXFe95S29omkXHE-ikOzNk5bZ'